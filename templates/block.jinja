{% extends 'base.jinja' %}

{% block content %} 
    <body class="tyn-body">
    <div class="tyn-root" style="--appbar-height: 73px;">
        {% include 'header.jinja' %}
        <div class="tyn-content tyn-contact  has-aside-base">
            <div class="tyn-aside tyn-aside-base">
                <div class="tyn-aside-head">
                    <div class="tyn-aside-head-text">
                        <h3 class="tyn-aside-title tyn-title">User list</h3>
                        {# <span class="tyn-subtext">127 Contacts</span> #}
                    </div>
                </div><!-- .tyn-aside-head -->
                <div class="tyn-aside-row pt-0">
                    <ul class="nav nav-tabs nav-tabs-line" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#user-active" type="button" aria-selected="false" tabindex="-1" role="tab"> Active </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#article-blocked" type="button" aria-selected="false" tabindex="-1" role="tab"> Article blocked </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#group-blocked" type="button" aria-selected="true" role="tab"> Group blocked </button>
                        </li>
                    </ul><!-- .nav -->
                </div><!-- .tyn-aside-row -->
                <div class="tyn-aside-body" data-simplebar="init"><div class="simplebar-wrapper" style="margin: 0px;"><div class="simplebar-height-auto-observer-wrapper"><div class="simplebar-height-auto-observer"></div></div><div class="simplebar-mask"><div class="simplebar-offset" style="right: 0px; bottom: 0px;"><div class="simplebar-content-wrapper" tabindex="0" role="region" aria-label="scrollable content" style="height: 100%; overflow: hidden scroll;"><div class="simplebar-content" style="padding: 0px;">
                    <div class="tyn-aside-search">
                        <div class="form-group tyn-pill">
                            <div class="form-control-wrap">
                                <div class="form-control-icon start">
                                    <!-- search -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"></path>
                                    </svg>
                                </div>
                                <input type="text" class="form-control form-control-solid" id="search-user" placeholder="Search user">
                            </div>
                        </div>
                    </div><!-- .tyn-aside-search -->
                    <div class="tab-content">
                        <div class="tab-pane show active" id="user-active" tabindex="0" role="tabpanel">
                            <ul class="tyn-aside-list"></ul>
                        </div><!-- .tab-pane -->
                        <div class="tab-pane" id="group-blocked" tabindex="0" role="tabpanel">
                            <ul class="tyn-aside-list"></ul>
                        </div><!-- .tab-pane -->
                        <div class="tab-pane" id="article-blocked" tabindex="0" role="tabpanel">
                            <ul class="tyn-aside-list"></ul>
                        </div><!-- .tab-pane -->
                        
                    </div><!-- .tab-content -->
                </div></div></div></div><div class="simplebar-placeholder" style="width: auto; height: 772px;"></div></div><div class="simplebar-track simplebar-horizontal" style="visibility: hidden;"><div class="simplebar-scrollbar" style="width: 0px; display: none;"></div></div><div class="simplebar-track simplebar-vertical" style="visibility: visible;"><div class="simplebar-scrollbar" style="height: 133px; transform: translate3d(0px, 0px, 0px); display: block;"></div></div></div><!-- .tyn-aside-body -->
            </div><!-- .tyn-aside -->
            
            
            <div class="tyn-main tyn-content-inner v-hidden" id="tynMain">
                <div class="container">
                    <div class="tyn-profile">
                        <ul class="tyn-list-inline d-md-none translate-middle position-absolute start-50 z-1">
                            <li>
                                <button class="btn btn-icon btn-pill btn-white js-toggle-main">
                                    <!-- x-lg -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path>
                                    </svg>
                                </button>
                            </li>
                        </ul>
                        <div class="tyn-profile-head">
                            <div class="tyn-profile-cover">
                                <img class="tyn-profile-cover-image" src="/static/images/cover/2.jpg" alt="">
                            </div>
                            <div class="tyn-profile-info">
                                <div class="tyn-media-group align-items-start">
                                    <div class="tyn-media tyn-media-bordered tyn-size-4xl tyn-profile-avatar">
                                        <img src="#" alt="">
                                    </div>
                                    <div class="tyn-media-col">
                                        <div class="tyn-media-row">
                                            <h4 class="name">user.fullname <span class="username">@ user.username</span></h4>
                                        </div>
                                        
                                        <div class="tyn-media-row pt-2">
                                            <div class="tyn-media-multiple">
                                                <div class="tyn-media tyn-circle tyn-size-md tyn-media-bordered">
                                                    <img src="/static/images/avatar/2.svg" alt="">
                                                </div>
                                                <div class="tyn-media tyn-circle tyn-size-md tyn-media-bordered">
                                                    <img src="/static/images/avatar/3.svg" alt="">
                                                </div>
                                                <div class="tyn-media tyn-circle tyn-size-md tyn-media-bordered">
                                                    <img src="/static/images/avatar/4.svg" alt="">
                                                </div>
                                                <div class="tyn-media tyn-circle tyn-size-md tyn-media-bordered">
                                                    <img src="/static/images/avatar/5.svg" alt="">
                                                </div>
                                                <div class="tyn-media tyn-circle tyn-size-md tyn-media-bordered">
                                                    <img src="/static/images/avatar/6.svg" alt="">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- .tyn-media-group -->
                            </div><!-- .tyn-profile-info -->
                        </div><!-- .tyn-profile-head -->
                        <div class="tyn-profile-nav">
                            <ul class="nav nav-tabs nav-tabs-line border-0" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-about" type="button" aria-selected="true" role="tab"> About </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-contacts" type="button" aria-selected="false" tabindex="-1" role="tab"> Mutual Contacts </button>
                                </li>
                            </ul><!-- .nav -->
                            <ul class="tyn-list-inline gap gap-3 ms-auto me-n1">
                                <li class="dropdown">
                                    <button class="btn btn-icon btn-md btn-transparent btn-pill dropdown-toggle" data-bs-toggle="dropdown" data-bs-offset="0,0">
                                        <!-- three-dots -->
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
                                            <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"></path>
                                        </svg>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end">
                                        <ul class="tyn-list-links">
                                            <li>
                                                <a href="index.html">
                                                    <!-- chat -->
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
                                                        <path d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105"></path>
                                                    </svg>
                                                    <span>Send Message</span>
                                                </a>
                                            </li>
                                            <li class="dropdown-divider"></li>
                                            <li>
                                                <a href="#">
                                                    <!-- person-x -->
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-x" viewBox="0 0 16 16">
                                                        <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"></path>
                                                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m-.646-4.854.646.647.646-.647a.5.5 0 0 1 .708.708l-.647.646.647.646a.5.5 0 0 1-.708.708l-.646-.647-.646.647a.5.5 0 0 1-.708-.708l.647-.646-.647-.646a.5.5 0 0 1 .708-.708"></path>
                                                    </svg>
                                                    <span>Block</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#">
                                                    <!-- exclamation-triangle -->
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                                                        <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"></path>
                                                        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"></path>
                                                    </svg>
                                                    <span>Report</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div><!-- .dropdown-menu -->
                                </li><!-- .dropdown -->
                            </ul><!-- .tyn-list-inline -->
                        </div><!-- .tyn-profile-nav -->
                        <div class="tyn-profile-details">
                            <div class="tab-content">
                                <div class="tab-pane show active" id="profile-about" tabindex="0" role="tabpanel"></div>
                                
                                <div class="tab-pane" id="profile-contacts" tabindex="0" role="tabpanel">
                                    <div class="row g-gs">
                                        <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                            <div class="border border-light rounded-3 py-4 px-3 h-100 d-flex flex-column align-items-center justify-content-center text-center">
                                                <div class="tyn-media tyn-size-2xl tyn-circle mb-3">
                                                    <img src="/static/images/avatar/2.svg" alt="">
                                                </div>
                                                <span class="tyn-subtext mb-1">@arnold_nces</span>
                                                <h6>Frances Arnold</h6>
                                            </div><!-- team-item -->
                                        </div><!-- .col -->
                                        <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                            <div class="border border-light rounded-3 py-4 px-3 h-100 d-flex flex-column align-items-center justify-content-center text-center">
                                                <div class="tyn-media tyn-size-2xl tyn-circle mb-3">
                                                    <img src="/static/images/avatar/3.svg" alt="">
                                                </div>
                                                <span class="tyn-subtext mb-1">@konstatin_nk</span>
                                                <h6>Konstantin Frank</h6>
                                            </div><!-- team-item -->
                                        </div><!-- .col -->
                                        <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                            <div class="border border-light rounded-3 py-4 px-3 h-100 d-flex flex-column align-items-center justify-content-center text-center">
                                                <div class="tyn-media tyn-size-2xl tyn-circle mb-3">
                                                    <img src="/static/images/avatar/4.svg" alt="">
                                                </div>
                                                <span class="tyn-subtext mb-1">@hederson</span>
                                                <h6>Albert Henderson</h6>
                                            </div><!-- team-item -->
                                        </div><!-- .col -->
                                        <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                            <div class="border border-light rounded-3 py-4 px-3 h-100 d-flex flex-column align-items-center justify-content-center text-center">
                                                <div class="tyn-media tyn-size-2xl tyn-circle mb-3">
                                                    <img src="/static/images/avatar/5.svg" alt="">
                                                </div>
                                                <span class="tyn-subtext mb-1">@enne_nolan</span>
                                                <h6>Nolan Etienne</h6>
                                            </div><!-- team-item -->
                                        </div><!-- .col -->
                                        <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                            <div class="border border-light rounded-3 py-4 px-3 h-100 d-flex flex-column align-items-center justify-content-center text-center">
                                                <div class="tyn-media tyn-size-2xl tyn-circle mb-3">
                                                    <img src="/static/images/avatar/6.svg" alt="">
                                                </div>
                                                <span class="tyn-subtext mb-1">@maxim</span>
                                                <h6>Maxim Werner</h6>
                                            </div><!-- team-item -->
                                        </div><!-- .col -->
                                        <div class="col-xxl-2 col-xl-3 col-lg-4 col-sm-6">
                                            <div class="border border-light rounded-3 py-4 px-3 h-100 d-flex flex-column align-items-center justify-content-center text-center">
                                                <div class="tyn-media tyn-size-2xl tyn-circle mb-3">
                                                    <img src="/static/images/avatar/7.svg" alt="">
                                                </div>
                                                <span class="tyn-subtext mb-1">@chavez_red</span>
                                                <h6>Mildred Chavez</h6>
                                            </div><!-- team-item -->
                                        </div><!-- .col -->
                                    </div><!-- .row -->
                                </div><!-- .tab-pane -->
                            </div><!-- .tab-content -->
                        </div><!-- .tyn-profile-details -->
                    </div>
                </div><!-- .container -->
            </div><!-- .tyn-main -->
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="addContact">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content border-0">
                <div class="modal-body p-4">
                    <h4 class="pb-2">Search by UserName</h4>
                    <div class="form-group">
                        <div class="form-control-wrap">
                            <div class="form-control-icon start">
                                <!-- search -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"></path>
                                </svg>
                            </div>
                            <input type="text" class="form-control form-control-solid" id="search-user" placeholder="Enter username">
                        </div>
                    </div>
                    <ul class="tyn-media-list gap gap-3 pt-4" id="contact-search">
                    </ul><!-- .tyn-media-list -->
                </div><!-- .modal-body -->
                <button class="btn btn-md btn-icon btn-pill btn-white shadow position-absolute top-0 end-0 mt-n3 me-n3" data-bs-dismiss="modal">
                    <!-- x-lg -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"></path>
                    </svg>
                </button>
            </div><!-- .modal-content -->
        </div><!-- .modal-dialog -->
    </div><!-- .modal -->
    <script>
        async function getBlocks(action, q = ""){
            return await axios.get(`/api/blocks?action=${action}&q=${q}`, {}, {
                headers: {
                    "X-CSRF-TOKEN": getCookie("csrf_access_token")
                }
            })
        }

        async function searchFriend(username){
            return await axios.get(`/api/users/${username}`, {}, {
                headers: {
                    "X-CSRF-TOKEN": getCookie("csrf_access_token")
                }
            })
        }

        async function createBlock(typeBlock, userBlock) {
            try {
                const res = await axios.post("/api/blocks", {
                    typeBlock,
                    userBlock
                }, {
                    headers: {
                        "X-CSRF-TOKEN": getCookie("csrf_access_token")
                    }
                })

                await renderAllTab()
                alert_success("Create successfully!")
            } catch (error) {
                console.log(error)
            }
        }
        
        async function unblock(typeBlock, userBlock) {
            try {
                const res = await axios.delete(`/api/blocks?type_block=${typeBlock}&user_block=${userBlock}`, {
                    headers: {
                        "X-CSRF-TOKEN": getCookie("csrf_access_token")
                    }
                })
                await renderAllTab()
                alert_success("Unblock successfully!")
            } catch (error) {
                console.log(error)
            }
        } 
    </script>
    <script>
        function renderButton(user){
            let btn = ""
            if(user.status == -1){
                btn = `
                    <button class="btn btn-icon btn-white btn-pill" id="icon-${user?.username}" onclick="addFriend('${user?.username}')">
                        <!-- person-plus-fill -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus-fill" viewBox="0 0 16 16">
                            <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"></path>
                            <path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5"></path>
                        </svg>
                    </button>
                `
            }
            else if(user.status == 0){
                btn = `
                    <button class="btn btn-icon btn-white btn-pill" id="icon-${user?.username}" onclick="addFriend('${user?.username}')">
                        <img class="btn-icon-1" src="/static/images/friend/waiting.png" alt=""> 
                    </button>
                `
            } else {
                btn = `
                    <button class="btn btn-icon btn-white btn-pill" id="icon-${user?.username}" onclick="addFriend('${user?.username}')">
                        <img class="btn-icon-1" src="/static/images/friend/cancel.png" alt="">
                    </button>
                `
            }

            return btn
        }

        async function renderProfile(username){
            try {
                const { data } = await searchFriend(username)
                const tynMain = document.getElementById("tynMain");
                if (tynMain && tynMain.classList.contains("v-hidden")) {
                    tynMain.classList.remove("v-hidden");
                }

                document.querySelector(".tyn-profile-avatar > img").src = data.data[0].avatar
                document.querySelector('.tyn-profile-info .tyn-media-col h4').innerHTML = `
                    ${data.data[0].fullname} <span class="username">@${data.data[0].username}</span>
                `
            } catch (error){
                console.log(error)
            }
        }

        function renderSearch(users){
            let html = ""
            for(let user of users){
                html += `
                    <li>
                        <div class="tyn-media-group">
                            <div class="tyn-media" style="background-color: #dbeafe;">
                                <img src="${user?.avatar}" alt="">
                            </div>
                            <div class="tyn-media-col">
                                <div class="tyn-media-row">
                                    <h6 class="name">${user?.fullname}</h6>
                                </div>
                                <div class="tyn-media-row">
                                    <p class="content">@${user?.username}</p>
                                </div>
                            </div>
                            <ul class="tyn-media-option-list me-n1">
                                <li class="dropdown">
                                    ${renderButton(user)}
                                </li>
                            </ul>
                        </div>
                    </li>`
            } 
            
            return html
        }

        function renderAcceptBtn(selector, username){
            let acceptBtn = ""
            if(selector == "#article-blocked > ul"){
                acceptBtn = `
                    <li class="dropdown-divider"></li>
                    <li onclick=acceptFriend('${username}')>
                        <a href="javascript:void(0)">
                            <!-- chat -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 64 64" stroke-width="3" stroke="#000000" fill="none"><circle cx="29.22" cy="16.28" r="11.14"/><path d="M41.32,35.69c-2.69-1.95-8.34-3.25-12.1-3.25h0A22.55,22.55,0,0,0,6.67,55h29.9"/><circle cx="45.38" cy="46.92" r="11.94"/><line x1="45.98" y1="39.8" x2="45.98" y2="53.8"/><line x1="38.98" y1="46.8" x2="52.98" y2="46.8"/></svg>
                            <span>Accept friend</span>
                        </a>
                    </li>
                `
            }
            
            return acceptBtn
        } 

        function renderDeleteBtn(selector, username){
            if(selector == "#group-blocked > ul"){
                return `
                    <li class="dropdown-divider"></li>
                    <li onclick=unfriend('${username}')>
                        <a href="javascript:void(0)">
                            <!-- chat -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 64 64" stroke-width="3" stroke="#000000" fill="none"><circle cx="29.22" cy="16.28" r="11.14"/><path d="M41.32,35.69c-2.69-1.95-8.34-3.25-12.1-3.25h0A22.55,22.55,0,0,0,6.67,55h29.9"/><circle cx="45.38" cy="46.92" r="11.94"/><line x1="38.98" y1="46.8" x2="52.98" y2="46.8"/></svg>
                            <span>Unfriend</span>
                        </a>
                    </li>
                `
            }

            if(["#user-active > ul", "#article-blocked > ul"].includes(selector)){
                return `
                    <li class="dropdown-divider"></li>
                    <li onclick=unfriend('${username}')>
                        <a href="javascript:void(0)">
                            <!-- chat -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 64 64" stroke-width="3" stroke="#000000" fill="none"><circle cx="29.22" cy="16.28" r="11.14"/><path d="M41.32,35.69c-2.69-1.95-8.34-3.25-12.1-3.25h0A22.55,22.55,0,0,0,6.67,55h29.9"/><circle cx="45.38" cy="46.92" r="11.94"/><line x1="38.98" y1="46.8" x2="52.98" y2="46.8"/></svg>
                            <span>Cancel request</span>
                        </a>
                    </li>
                `
            }
            
            return ""
        } 

        function renderDropdown(selected, user){
            if(selected == "#user-active > ul"){
                return `
                    <li>
                        <a href="javascript:void(0)" onclick="createBlock('article', ${user?.user_id})">
                            <!-- person -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 24 24" fill="none">
                                <path d="M18.364 5.63604C19.9926 7.26472 21 9.51472 21 12C21 16.9706 16.9706 21 12 21C9.51472 21 7.26472 19.9926 5.63604 18.364M18.364 5.63604C16.7353 4.00736 14.4853 3 12 3C7.02944 3 3 7.02944 3 12C3 14.4853 4.00736 16.7353 5.63604 18.364M18.364 5.63604L5.63604 18.364" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span>Block create article</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" onclick="createBlock('group', ${user?.user_id})">
                            <!-- person -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 24 24" fill="none">
                                <path d="M18.364 5.63604C19.9926 7.26472 21 9.51472 21 12C21 16.9706 16.9706 21 12 21C9.51472 21 7.26472 19.9926 5.63604 18.364M18.364 5.63604C16.7353 4.00736 14.4853 3 12 3C7.02944 3 3 7.02944 3 12C3 14.4853 4.00736 16.7353 5.63604 18.364M18.364 5.63604L5.63604 18.364" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span>Block create group</span>
                        </a>
                    </li>
                    <li class="dropdown-divider"></li>
                    <li>
                        <a href="javascript:void(0)" onclick="createBlock('all', ${user?.user_id})">
                            <!-- person -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 24 24" fill="none">
                                <path d="M18.364 5.63604C19.9926 7.26472 21 9.51472 21 12C21 16.9706 16.9706 21 12 21C9.51472 21 7.26472 19.9926 5.63604 18.364M18.364 5.63604C16.7353 4.00736 14.4853 3 12 3C7.02944 3 3 7.02944 3 12C3 14.4853 4.00736 16.7353 5.63604 18.364M18.364 5.63604L5.63604 18.364" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span>Block all</span>
                        </a>
                    </li>
                `
            }

            if(selected == "#article-blocked > ul"){
                return `
                    <li>
                        <a href="javascript:void(0)" onclick="unblock('article', ${user.user_id})">
                            <!-- person -->
                            <svg xmlns="http://www.w3.org/2000/svg" fill="#000000" width="800px" height="800px" viewBox="0 0 256 256">
                                <path d="M82.757 128l-8.662-15.546C59.565 86.38 59.273 59.84 84.248 46.56l12.318-6.533c27.248-13.823 47.58 1.422 62.114 27.505l17.307 31.062-14.612 7.413c-.95.482-6.824-12.246-15.349-27.546l-1.959-3.516c-10.23-18.36-18.63-29.368-38.728-19.173l-11.12 5.508c-25.096 12.71-9.972 35.728-5.5 43.756l1.96 3.515L101.515 128h82.478c4.416 0 8.007 3.586 8.007 8.01v84.98c0 4.43-3.585 8.01-8.007 8.01H72.007c-4.416 0-8.007-3.586-8.007-8.01v-84.98c0-4.43 3.585-8.01 8.007-8.01h10.75zM176 148.316c0-2.384-1.547-4.316-3.46-4.316H83.46c-1.911 0-3.46 1.936-3.46 4.316v60.368c0 2.384 1.547 4.316 3.46 4.316h89.08c1.911 0 3.46-1.936 3.46-4.316v-60.368z" fill-rule="evenodd"/>
                            </svg>
                            <span>Unblock create article</span>
                        </a>
                    </li>
                    <li class="dropdown-divider"></li>
                    <li>
                        <a href="javascript:void(0)" onclick="createBlock('group', ${user?.user_id})">
                            <!-- person -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 24 24" fill="none">
                                <path d="M18.364 5.63604C19.9926 7.26472 21 9.51472 21 12C21 16.9706 16.9706 21 12 21C9.51472 21 7.26472 19.9926 5.63604 18.364M18.364 5.63604C16.7353 4.00736 14.4853 3 12 3C7.02944 3 3 7.02944 3 12C3 14.4853 4.00736 16.7353 5.63604 18.364M18.364 5.63604L5.63604 18.364" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span>Block create group</span>
                        </a>
                    </li>
                `
            }

            if(selected == "#group-blocked > ul"){
                return `
                    <li>
                        <a href="javascript:void(0)" onclick="unblock('group', ${user.user_id})">
                            <!-- person -->
                            <svg xmlns="http://www.w3.org/2000/svg" fill="#000000" width="800px" height="800px" viewBox="0 0 256 256">
                                <path d="M82.757 128l-8.662-15.546C59.565 86.38 59.273 59.84 84.248 46.56l12.318-6.533c27.248-13.823 47.58 1.422 62.114 27.505l17.307 31.062-14.612 7.413c-.95.482-6.824-12.246-15.349-27.546l-1.959-3.516c-10.23-18.36-18.63-29.368-38.728-19.173l-11.12 5.508c-25.096 12.71-9.972 35.728-5.5 43.756l1.96 3.515L101.515 128h82.478c4.416 0 8.007 3.586 8.007 8.01v84.98c0 4.43-3.585 8.01-8.007 8.01H72.007c-4.416 0-8.007-3.586-8.007-8.01v-84.98c0-4.43 3.585-8.01 8.007-8.01h10.75zM176 148.316c0-2.384-1.547-4.316-3.46-4.316H83.46c-1.911 0-3.46 1.936-3.46 4.316v60.368c0 2.384 1.547 4.316 3.46 4.316h89.08c1.911 0 3.46-1.936 3.46-4.316v-60.368z" fill-rule="evenodd"/>
                            </svg>
                            <span>Unblock create group</span>
                        </a>
                    </li>
                    <li class="dropdown-divider"></li>
                    <li>
                        <a href="javascript:void(0)" onclick="createBlock('article', ${user?.user_id})">
                            <!-- person -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 24 24" fill="none">
                                <path d="M18.364 5.63604C19.9926 7.26472 21 9.51472 21 12C21 16.9706 16.9706 21 12 21C9.51472 21 7.26472 19.9926 5.63604 18.364M18.364 5.63604C16.7353 4.00736 14.4853 3 12 3C7.02944 3 3 7.02944 3 12C3 14.4853 4.00736 16.7353 5.63604 18.364M18.364 5.63604L5.63604 18.364" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span>Block create article</span>
                        </a>
                    </li>
                `
            }

            return ""
        }

        function renderContact(selector, users){
            let html = ""
            let textBtn = "Unfriend"
            for(let idx in users){
                html += `
                    <li class="tyn-aside-item js-toggle-main ${idx == 0 ? 'active' : ''}" onclick="renderProfile('${users[idx]?.username}')">
                        <div class="tyn-media-group">
                            <div class="tyn-media tyn-size-lg" style="background-color: #dbeafe;">
                                <img src="${users[idx]?.avatar}" alt="">
                            </div>
                            <div class="tyn-media-col">
                                <div class="tyn-media-row">
                                    <h6 class="name">${users[idx]?.fullname}</h6>
                                </div>
                                <div class="tyn-media-row">
                                    <p class="content">@${users[idx]?.username}</p>
                                </div>
                            </div>
                            <div class="tyn-media-option tyn-aside-item-option">
                                <ul class="tyn-media-option-list">
                                    <li class="dropdown">
                                        <div class="btn btn-icon btn-white btn-pill dropdown-toggle" data-bs-toggle="dropdown" data-bs-offset="0,0">
                                            <!-- three-dots -->
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
                                                <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"></path>
                                            </svg>
                                        </div>
                                        <div class="dropdown-menu dropdown-menu-end">
                                            <ul class="tyn-list-links">
                                                {# ${renderAcceptBtn(selector, users[idx]?.username)} #}
                                                {# ${renderDeleteBtn(selector, users[idx]?.username)} #}
                                                ${renderDropdown(selector, users[idx])}
                                            </ul><!-- .tyn-list-links -->
                                        </div><!-- .dropdown-menu -->
                                    </li>
                                </ul><!-- .tyn-media-option-list -->
                            </div><!-- .tyn-media-option -->
                        </div>
                    </li><!-- .tyn-aside-item -->
                `
            }

            document.querySelector(selector).innerHTML = html
        }

        async function renderAllTab(){
            const result = await Promise.all([
                getBlocks("active"),
                getBlocks("article-blocked"),
                getBlocks("group-blocked"),
            ])

            renderContact("#user-active > ul", result[0].data.data)
            renderContact("#article-blocked > ul", result[1].data.data)
            renderContact("#group-blocked > ul", result[2].data.data)
        }

        async function renderAllTabAndSearch(q){
            const result = await Promise.all([
                getBlocks("active", q),
                getBlocks("article-blocked", q),
                getBlocks("group-blocked", q),
            ])

            renderContact("#user-active > ul", result[0].data.data)
            renderContact("#article-blocked > ul", result[1].data.data)
            renderContact("#group-blocked > ul", result[2].data.data)
        }

        document.addEventListener('DOMContentLoaded', async() => {
            await renderAllTab()
        });

        document.getElementById("search-user").addEventListener("input", async() => {
            try {
                const q = $("#search-user").val()
                const { data } = await renderAllTabAndSearch(q)
            } catch (error){
                console.log(error)
            }
        })
    </script>
    <script src="/static/js/libs/socket.io.min.js"></script>
    <script>
        const socket = io();
        socket.on("connect", () => {
            console.log(socket.id);
        });
    </script>
</body>
{% endblock %}